{"ast":null,"code":"import _objectSpread from\"/Users/luuduylinh/Desktop/PhoneStore/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/luuduylinh/Desktop/PhoneStore/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/luuduylinh/Desktop/PhoneStore/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';import jwt_decode from'jwt-decode';import httpRequest from\"./utils/httpRequest\";var refreshToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return httpRequest.post('/user/auth/refresh',{withCredentials:true});case 3:res=_context.sent;return _context.abrupt(\"return\",res.data);case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return function refreshToken(){return _ref.apply(this,arguments);};}();export var createAxios=function createAxios(user,dispatch,stateSuccess){var newInstance=axios.create({baseURL:process.env.REACT_APP_URL});newInstance.interceptors.request.use(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(config){var date,decodedToken,data,refreshUser;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:date=new Date();decodedToken=jwt_decode(user.accessToken);console.log(user,date.getTime()/1000);if(!(decodedToken.exp<date.getTime()/1000)){_context2.next=10;break;}_context2.next=6;return refreshToken();case 6:data=_context2.sent;refreshUser=_objectSpread(_objectSpread({},user),{},{accessToken:data.accessToken});dispatch(stateSuccess(refreshUser));config.headers['token']=\"Bearer \".concat(data.accessToken);case 10:return _context2.abrupt(\"return\",config);case 11:case\"end\":return _context2.stop();}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),function(err){return Promise.reject(err);});return newInstance;};","map":{"version":3,"names":["axios","jwt_decode","httpRequest","refreshToken","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","wrap","_callee$","_context","prev","next","post","withCredentials","sent","abrupt","data","t0","console","log","stop","apply","arguments","createAxios","user","dispatch","stateSuccess","newInstance","create","baseURL","process","env","REACT_APP_URL","interceptors","request","use","_ref2","_callee2","config","date","decodedToken","refreshUser","_callee2$","_context2","Date","accessToken","getTime","exp","_objectSpread","headers","concat","_x","err","Promise","reject"],"sources":["/Users/luuduylinh/Desktop/PhoneStore/src/createInstance.js"],"sourcesContent":["import axios from 'axios';\nimport jwt_decode from 'jwt-decode';\nimport httpRequest from '~/utils/httpRequest';\n\nconst refreshToken = async () => {\n    try {\n        const res = await httpRequest.post('/user/auth/refresh', {\n            withCredentials: true,\n        });\n        return res.data;\n    } catch (err) {\n        console.log(err);\n    }\n};\n\nexport const createAxios = (user, dispatch, stateSuccess) => {\n    const newInstance = axios.create({ baseURL: process.env.REACT_APP_URL });\n    newInstance.interceptors.request.use(\n        async (config) => {\n            let date = new Date();\n            const decodedToken = jwt_decode(user.accessToken);\n            console.log(user, date.getTime() / 1000);\n            if (decodedToken.exp < date.getTime() / 1000) {\n                const data = await refreshToken();\n                const refreshUser = {\n                    ...user,\n                    accessToken: data.accessToken,\n                };\n                dispatch(stateSuccess(refreshUser));\n                config.headers['token'] = `Bearer ${data.accessToken}`;\n            }\n            return config;\n        },\n        (err) => {\n            return Promise.reject(err);\n        },\n    );\n    return newInstance;\n};\n"],"mappings":"6XAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,UAAU,KAAM,YAAY,CACnC,MAAO,CAAAC,WAAW,2BAElB,GAAM,CAAAC,YAAY,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA,MAAAC,GAAA,QAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAEK,CAAAZ,WAAW,CAACa,IAAI,CAAC,oBAAoB,CAAE,CACrDC,eAAe,CAAE,IACrB,CAAC,CAAC,QAFIP,GAAG,CAAAG,QAAA,CAAAK,IAAA,QAAAL,QAAA,CAAAM,MAAA,UAGFT,GAAG,CAACU,IAAI,SAAAP,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAQ,EAAA,CAAAR,QAAA,aAEfS,OAAO,CAACC,GAAG,CAAAV,QAAA,CAAAQ,EAAI,CAAC,CAAC,yBAAAR,QAAA,CAAAW,IAAA,MAAAf,OAAA,gBAExB,kBATK,CAAAL,YAAYA,CAAA,SAAAC,IAAA,CAAAoB,KAAA,MAAAC,SAAA,OASjB,CAED,MAAO,IAAM,CAAAC,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAIC,IAAI,CAAEC,QAAQ,CAAEC,YAAY,CAAK,CACzD,GAAM,CAAAC,WAAW,CAAG9B,KAAK,CAAC+B,MAAM,CAAC,CAAEC,OAAO,CAAEC,OAAO,CAACC,GAAG,CAACC,aAAc,CAAC,CAAC,CACxEL,WAAW,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,6BAAAC,KAAA,CAAAlC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAChC,SAAAiC,SAAOC,MAAM,MAAAC,IAAA,CAAAC,YAAA,CAAAxB,IAAA,CAAAyB,WAAA,QAAAtC,mBAAA,GAAAI,IAAA,UAAAmC,UAAAC,SAAA,iBAAAA,SAAA,CAAAjC,IAAA,CAAAiC,SAAA,CAAAhC,IAAA,SACL4B,IAAI,CAAG,GAAI,CAAAK,IAAI,CAAC,CAAC,CACfJ,YAAY,CAAG1C,UAAU,CAAC0B,IAAI,CAACqB,WAAW,CAAC,CACjD3B,OAAO,CAACC,GAAG,CAACK,IAAI,CAAEe,IAAI,CAACO,OAAO,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,KACrCN,YAAY,CAACO,GAAG,CAAGR,IAAI,CAACO,OAAO,CAAC,CAAC,CAAG,IAAI,GAAAH,SAAA,CAAAhC,IAAA,WAAAgC,SAAA,CAAAhC,IAAA,SACrB,CAAAX,YAAY,CAAC,CAAC,QAA3BgB,IAAI,CAAA2B,SAAA,CAAA7B,IAAA,CACJ2B,WAAW,CAAAO,aAAA,CAAAA,aAAA,IACVxB,IAAI,MACPqB,WAAW,CAAE7B,IAAI,CAAC6B,WAAW,GAEjCpB,QAAQ,CAACC,YAAY,CAACe,WAAW,CAAC,CAAC,CACnCH,MAAM,CAACW,OAAO,CAAC,OAAO,CAAC,WAAAC,MAAA,CAAalC,IAAI,CAAC6B,WAAW,CAAE,CAAC,eAAAF,SAAA,CAAA5B,MAAA,UAEpDuB,MAAM,2BAAAK,SAAA,CAAAvB,IAAA,MAAAiB,QAAA,GAChB,mBAAAc,EAAA,SAAAf,KAAA,CAAAf,KAAA,MAAAC,SAAA,QACD,SAAC8B,GAAG,CAAK,CACL,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACF,GAAG,CAAC,CAC9B,CACJ,CAAC,CACD,MAAO,CAAAzB,WAAW,CACtB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}